import{a as x,o as t,w as Y}from"./chunk-QMGIS6GS-DqORk8pi.js";import{L as q}from"./Loading-DDn8iYM2.js";import{m as U,H as F,I as Z,J as N,K as G,l as E,M as W,N as V,O as _,Q as H,R as ee,y as Q,u as J,S as te,U as oe,v as se,i as ne,V as re,W as ie,X as le,E as ae}from"./link-DLQH289a.js";import{D as de,B as D,T as P,a as ce}from"./Table-CNeg-TMI.js";import{F as I,I as ue,M as pe}from"./ManageLayout-t3KEE2G7.js";import{f as fe}from"./formatDuration-DSjjpX6K.js";import{u as xe,C as ge}from"./types-B02bDBLB.js";import{S as he,M as ve}from"./Select-CXKZpMUJ.js";import{d as A,L as me,A as ye,D as je,S as Ce}from"./SessionDialog-CqWJBGnw.js";import{S as be}from"./ScanDialog-Rw4j43Mh.js";import"./index-DiSreKSV.js";import"./List-qEd4ucO3.js";import"./index-BCRDjQkr.js";import"./ListItem-DQRoVHJ-.js";function Se(e){return x.Children.toArray(e).filter(o=>x.isValidElement(o))}function Be(e){return F("MuiToggleButton",e)}const T=U("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),K=x.createContext({}),X=x.createContext(void 0);function ze(e,o){return o===void 0||e===void 0?!1:Array.isArray(o)?o.includes(e):e===o}const we=e=>{const{classes:o,fullWidth:r,selected:c,disabled:u,size:p,color:f}=e,n={root:["root",c&&"selected",u&&"disabled",r&&"fullWidth",`size${W(p)}`,f]};return V(n,Be,o)},Re=G(_,{name:"MuiToggleButton",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,o[`size${W(r.size)}`]]}})(H(({theme:e})=>({...e.typography.button,borderRadius:(e.vars||e).shape.borderRadius,padding:11,border:`1px solid ${(e.vars||e).palette.divider}`,color:(e.vars||e).palette.action.active,[`&.${T.disabled}`]:{color:(e.vars||e).palette.action.disabled,border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${T.selected}`]:{color:(e.vars||e).palette.text.primary,backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette.text.primary,(e.vars||e).palette.action.selectedOpacity)}}}}},...Object.entries(e.palette).filter(ee()).map(([o])=>({props:{color:o},style:{[`&.${T.selected}`]:{color:(e.vars||e).palette[o].main,backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette[o].main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`),"@media (hover: none)":{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:e.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:e.typography.pxToRem(15)}}]}))),M=x.forwardRef(function(o,r){const{value:c,...u}=x.useContext(K),p=x.useContext(X),f=Z({...u,selected:ze(o.value,c)},o),n=N({props:f,name:"MuiToggleButton"}),{children:s,className:m,color:v="standard",disabled:b=!1,disableFocusRipple:y=!1,fullWidth:d=!1,onChange:S,onClick:B,selected:h,size:z="medium",value:i,...R}=n,w={...n,color:v,disabled:b,disableFocusRipple:y,fullWidth:d,size:z},j=we(w),$=g=>{B&&(B(g,i),g.defaultPrevented)||S&&S(g,i)},C=p||"";return t.jsx(Re,{className:E(u.className,j.root,m,C),disabled:b,focusRipple:!y,ref:r,onClick:$,onChange:S,value:i,ownerState:w,"aria-pressed":h,...R,children:s})});function Te(e){return F("MuiToggleButtonGroup",e)}const l=U("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),$e=e=>{const{classes:o,orientation:r,fullWidth:c,disabled:u}=e,p={root:["root",r,c&&"fullWidth"],grouped:["grouped",`grouped${W(r)}`,u&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return V(p,Te,o)},ke=G("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[{[`& .${l.grouped}`]:o.grouped},{[`& .${l.grouped}`]:o[`grouped${W(r.orientation)}`]},{[`& .${l.firstButton}`]:o.firstButton},{[`& .${l.lastButton}`]:o.lastButton},{[`& .${l.middleButton}`]:o.middleButton},o.root,r.orientation==="vertical"&&o.vertical,r.fullWidth&&o.fullWidth]}})(H(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${l.grouped}`]:{[`&.${l.selected} + .${l.grouped}.${l.selected}`]:{borderTop:0,marginTop:0}},[`& .${l.firstButton},& .${l.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${l.lastButton},& .${l.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${l.lastButton}.${T.disabled},& .${l.middleButton}.${T.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${l.grouped}`]:{[`&.${l.selected} + .${l.grouped}.${l.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${l.firstButton},& .${l.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${l.lastButton},& .${l.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${l.lastButton}.${T.disabled},& .${l.middleButton}.${T.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),De=x.forwardRef(function(o,r){const c=N({props:o,name:"MuiToggleButtonGroup"}),{children:u,className:p,color:f="standard",disabled:n=!1,exclusive:s=!1,fullWidth:m=!1,onChange:v,orientation:b="horizontal",size:y="medium",value:d,...S}=c,B={...c,disabled:n,fullWidth:m,orientation:b,size:y},h=$e(B),z=x.useCallback((C,g)=>{if(!v)return;const k=d&&d.indexOf(g);let L;d&&k>=0?(L=d.slice(),L.splice(k,1)):L=d?d.concat(g):[g],v(C,L)},[v,d]),i=x.useCallback((C,g)=>{v&&v(C,d===g?null:g)},[v,d]),R=x.useMemo(()=>({className:h.grouped,onChange:s?i:z,value:d,size:y,fullWidth:m,color:f,disabled:n}),[h.grouped,s,i,z,d,y,m,f,n]),w=Se(u),j=w.length,$=C=>{const g=C===0,k=C===j-1;return g&&k?"":g?h.firstButton:k?h.lastButton:h.middleButton};return t.jsx(ke,{role:"group",className:E(h.root,p),ref:r,ownerState:B,...S,children:t.jsx(K.Provider,{value:R,children:w.map((C,g)=>t.jsx(X.Provider,{value:$(g),children:C},g))})})});function Le(e){return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}function Oe({id:e,program:o,value:r,onChange:c,disabled:u=!1}){const{data:p=[]}=Q(o.id);console.log("InviteeSelector invitees:",p);const f=n=>{const s=p.find(m=>m.user.id===n.target.value);if(!s){console.error("Invitee not found for id:",n.target.value);return}c(s)};return t.jsx(he,{id:e,value:r==null?void 0:r.user.id,label:"Invitee",onChange:f,disabled:u,children:p.map(n=>t.jsx(ve,{value:n.user.id,children:xe(n.user)},n.user.id))})}const O={container:{width:"100%"},field:{marginBottom:"10px"}};function We({open:e,setOpen:o,session:r,program:c}){const u=J(),[p,{}]=te(),[f,n]=x.useState(""),[s,m]=x.useState(A()),[v,b]=x.useState(null),[y,d]=x.useState(""),[S,B]=x.useState(null),h=i=>{o(i),d(""),n(""),m(A()),b(null),B(null)},z=async()=>{if(v==null){d("Please select an invitee");return}if(f!=="checkin"&&f!=="checkout"){d("Please select check in or check out");return}try{p({badgeSignedValue:v.badge.signedValue,sessionId:r.id,state:f,createdAt:s.toISOString()})}catch(i){d(`Failed to add record: ${JSON.stringify(i)}`);return}h(!1)};return t.jsx(de,{open:e,setOpen:h,title:"Add Record",renderActions:()=>t.jsxs(t.Fragment,{children:[t.jsx(D,{onClick:z,children:"Save"}),t.jsx(D,{onClick:()=>h(!1),children:"Close"})]}),children:t.jsxs("div",{style:O.container,children:[t.jsx("div",{style:O.field,children:t.jsxs(I,{variant:"standard",fullWidth:!0,children:[t.jsx(ue,{htmlFor:"invitee",children:"Invitee"}),t.jsx(Oe,{id:"invitee",value:v,onChange:b,program:c})]})}),t.jsx("div",{style:O.field,children:t.jsx(I,{variant:"standard",fullWidth:!0,children:t.jsxs(De,{id:"state",fullWidth:!0,color:"primary",value:f,exclusive:!0,onChange:i=>n(i.target.value),children:[t.jsx(M,{value:"checkin",children:"Check in"}),t.jsx(M,{value:"checkout",children:"Check out"})]})})}),t.jsx("div",{style:O.field,children:t.jsx(I,{variant:"standard",fullWidth:!0,children:t.jsx(me,{dateAdapter:ye,children:t.jsx(je,{value:s,onChange:i=>m(i)})})})}),t.jsx("div",{style:{color:u.colors3.error,fontSize:u.font.sizes.lower2},children:y})]})})}function Ie({open:e,setOpen:o,predefinedProgram:r,session:c}){const[u,{}]=oe();return t.jsx(Ce,{open:e,setOpen:o,predefinedProgram:r,predefinedSession:c,onSave:async({name:p,programId:f,happensAt:n})=>{await u({id:c.id,name:p,programId:f,happensAt:n}).unwrap()}})}const a={container:{width:"100%",display:"flex",flexDirection:"column"},titleRow:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginBottom:"20px",marginLeft:"16px",marginRight:"16px"},title:{},actionbar:{display:"flex",flexDirection:"row",justifyContent:"end",alignItems:"center",gap:"5px"},detailsTable:{textAlign:"left",marginLeft:"16px",marginRight:"16px"},detailsLabel:{fontWeight:"bold"},detailsLink:{textDecoration:"underline"},section:{width:"100%",display:"flex",flexDirection:"column",marginTop:"30px",borderTop:"1px solid",paddingTop:"20px",minHeight:"100px"},sectionTitleRow:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginBottom:"5px",marginLeft:"16px",marginRight:"16px"},sectionTitle:{fontWeight:"bold"},lastColumn:{display:"flex",flexDirection:"row",justifyContent:"end"}};function Pe({session:e,program:o,workspace:r,invitees:c,inviteeInsights:u,records:p,relationName:f,capabilities:n}){const s=J(),m=se(),v=ne(),[b,y]=x.useState(!1),[d,S]=x.useState(!1),[B,h]=x.useState(!1),z={...a.section,borderColor:s.colors3.divider};return t.jsxs("div",{style:a.container,children:[t.jsxs("div",{style:a.titleRow,children:[t.jsx("div",{style:{...a.title,color:s.colors3.text1,fontSize:s.font.sizes.h1},children:e.name}),t.jsxs("div",{style:a.actionbar,children:[n.hasCapability("scanSession")&&t.jsxs(t.Fragment,{children:[t.jsx(D,{onClick:()=>S(!0),children:"Scan"}),t.jsx(be,{open:d,setOpen:S,session:e})]}),n.hasCapability("editSession")&&t.jsxs(t.Fragment,{children:[t.jsx(D,{onClick:()=>y(!0),children:"Edit"}),t.jsx(Ie,{open:b,setOpen:y,predefinedProgram:o,session:e})]})]})]}),t.jsx("table",{style:a.detailsTable,children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{style:{...a.detailsLabel,color:s.colors3.text1,fontSize:s.font.sizes.normal},children:"Program"}),t.jsx("td",{children:t.jsx("a",{href:o?v(o):"",style:{...a.detailsLink,...a.lastColumn,color:s.colors3.text1,fontSize:s.font.sizes.lower1,textDecorationColor:s.colors3.text1,textUnderlineOffset:s.font.sizes.textUnderlineOffset},children:o==null?void 0:o.name})})]}),t.jsxs("tr",{children:[t.jsx("td",{style:{...a.detailsLabel,color:s.colors3.text1,fontSize:s.font.sizes.normal},children:"Workspace"}),t.jsx("td",{children:t.jsx("a",{href:m(r),style:{...a.detailsLink,...a.lastColumn,color:s.colors3.text1,fontSize:s.font.sizes.lower1,textDecorationColor:s.colors3.text1,textUnderlineOffset:s.font.sizes.textUnderlineOffset},children:r.name})})]}),t.jsxs("tr",{children:[t.jsx("td",{style:{...a.detailsLabel,color:s.colors3.text1,fontSize:s.font.sizes.normal},children:"Your role"}),t.jsx("td",{style:{...a.lastColumn,color:s.colors3.text1,fontSize:s.font.sizes.lower1},children:f})]}),t.jsxs("tr",{children:[t.jsx("td",{style:{...a.detailsLabel,color:s.colors3.text1,fontSize:s.font.sizes.normal},children:"When"}),t.jsx("td",{style:{...a.lastColumn,color:s.colors3.text1,fontSize:s.font.sizes.lower1},children:Le(e.happensAt)})]})]})}),n.hasCapability("viewInvitees")&&t.jsxs("section",{style:z,children:[t.jsxs("div",{style:a.sectionTitleRow,children:[t.jsx("div",{style:{...a.sectionTitle,color:s.colors3.text1,fontSize:s.font.sizes.normal},children:"Invitees"}),t.jsx("div",{style:a.actionbar})]}),t.jsx(P,{data:u,fields:["invitee","insight"],getId:i=>i.user.id,renderCell:(i,R)=>{switch(R){case"invitee":return t.jsxs("div",{children:[t.jsx("div",{style:{color:s.colors3.text1,fontSize:s.font.sizes.normal},children:i.user.name}),t.jsx("div",{style:{color:s.colors3.text2,fontSize:s.font.sizes.lower2},children:i.user.email})]});case"insight":return t.jsx("div",{style:{...a.lastColumn,color:s.colors3.text1,fontSize:s.font.sizes.lower1},children:fe(i.totalDurationSeconds)})}}})]}),t.jsxs("section",{style:z,children:[t.jsxs("div",{style:a.sectionTitleRow,children:[t.jsx("div",{style:{...a.sectionTitle,color:s.colors3.text1,fontSize:s.font.sizes.normal},children:"Records"}),t.jsx("div",{style:a.actionbar,children:n.hasCapability("addRecord")&&t.jsxs(t.Fragment,{children:[t.jsx(D,{onClick:()=>h(!0),children:"Add"}),t.jsx(We,{open:B,setOpen:h,session:e,program:o})]})})]}),t.jsx(P,{data:p,fields:["user","state","time"],getId:i=>i.id,renderCell:(i,R)=>{switch(R){case"user":const w=c.find($=>$.user.id===i.userId),j=w==null?void 0:w.user;return t.jsxs("div",{children:[t.jsx("div",{style:{color:s.colors3.text1,fontSize:s.font.sizes.normal},children:j==null?void 0:j.name}),t.jsx("div",{style:{color:s.colors3.text2,fontSize:s.font.sizes.lower2},children:j==null?void 0:j.email})]});case"state":return t.jsx("div",{style:{color:s.colors3.text1,fontSize:s.font.sizes.lower1},children:Me(i.state)});case"time":return t.jsx("div",{style:{...a.lastColumn,color:s.colors3.text1,fontSize:s.font.sizes.lower1},children:Ae(new Date(i.createdAt))})}}})]})]})}function Ae(e){return new Intl.DateTimeFormat("en",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).format(e)}function Me(e){switch(e){case"checkin":return"Check in";case"checkout":return"Check out";default:return""}}function Ue({sessionId:e}){var n,s;const{data:o=null,error:r}=re({sessionId:e}),{data:{inviteeInsights:c=[],records:u=[]}={}}=ie(e),{data:p=[]}=Q(((n=o==null?void 0:o.program)==null?void 0:n.id)||"",{skip:!((s=o==null?void 0:o.program)!=null&&s.id)}),f=le();return ae(r,f),o==null?t.jsx(q,{}):t.jsx(ce,{currentPage:"manage",children:t.jsx(pe,{currentPage:"sessions",children:t.jsx(Pe,{session:o.session,program:o.program,workspace:o.workspace,invitees:p,inviteeInsights:c,records:u,relationName:o.session.relationName,capabilities:new ge(o.session.capabilities)})})})}const et=Y(function({params:o}){return t.jsx(Ue,{sessionId:o.sessionId})});export{et as default};
